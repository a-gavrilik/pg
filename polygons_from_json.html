<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Polygons</title>
  <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
  <style>
    html, body, #map {
      width: 100%;
      height: 100%;
      margin: 0;
    }
  </style>
</head>

<body>
<div id="map"></div>

<script>
async function loadPolygons() {
  const params = new URLSearchParams(window.location.search);
  const raw = params.get("l_ids");
  if (!raw) return [];
  return decodeURIComponent(raw).split(",");
}

ymaps.ready(async function () {
  const map = new ymaps.Map("map", {
    center: [55.75, 37.61],
    zoom: 9
  });

  const selectedIds = await loadPolygons();

  const resp = await fetch("polygons.json");
  const json = await resp.json();
  const allPolygons = json.polygons; 

  const filtered =
    selectedIds.length === 0
      ? allPolygons
      : allPolygons.filter(p => selectedIds.includes(p.l_id));

  filtered.forEach(p => {
    const polygon = new ymaps.Polygon(
      [p.coords],
      {},
      {
        fillColor: "#BDFF0055",
        strokeColor: "#BDFF00",
        strokeWidth: 1,
        Opacity: 0.6
      }
    );
    map.geoObjects.add(polygon);
  });

  if (map.geoObjects.getLength() > 0) {
    map.setBounds(map.geoObjects.getBounds(), { checkZoomRange: true });
  }
});
</script>

</body>
</html>
