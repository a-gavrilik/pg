<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Polygons</title>

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>

<style>
html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
</style>
</head>

<body>
<div id="map"></div>

<script>
function getSinglePolygon() {
  const params = new URLSearchParams(window.location.search);
  const raw = params.get("coords");
  if (!raw) return null;

  try {
    // URLSearchParams уже декодирует
    return JSON.parse(raw);
  } catch (e) {
    console.error("Single polygon parse error", e);
    return null;
  }
}

function getMultiplePolygons() {
  const params = new URLSearchParams(window.location.search);
  const raw = params.get("polygons");
  if (!raw) return null;

  try {
    return JSON.parse(raw);
  } catch (e) {
    console.error("Multiple polygons parse error", e);
    return null;
  }
}

ymaps.ready(function () {

  const map = new ymaps.Map("map", {
    center: [55.75, 37.61],
    zoom: 9
  });

  const geoObjects = [];

  // 1️⃣ Несколько полигонов
  const polygons = getMultiplePolygons();
  if (polygons && Array.isArray(polygons)) {
    polygons.forEach((coords, idx) => {
      const polygon = new ymaps.Polygon(
        [coords],
        {},
        {
          fillColor: "#474A5155",
          strokeColor: "#474A51",
          strokeWidth: 2
        }
      );
      map.geoObjects.add(polygon);
      geoObjects.push(polygon);
    });
  }

  // 2️⃣ Один полигон (fallback)
  if (geoObjects.length === 0) {
    const coords = getSinglePolygon();
    if (coords) {
      const polygon = new ymaps.Polygon(
        [coords],
        {},
        {
          fillColor: "#474A5155",
          strokeColor: "#474A51",
          strokeWidth: 2
        }
      );
      map.geoObjects.add(polygon);
      geoObjects.push(polygon);
    }
  }

  // 3️⃣ Авто-зум по всем объектам
  if (geoObjects.length > 0) {
    map.setBounds(
      ymaps.geoQuery(geoObjects).getBounds(),
      { checkZoomRange: true }
    );
  } else {
    console.warn("No polygons provided");
  }

});
</script>

</body>
</html>
