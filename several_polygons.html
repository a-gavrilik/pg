<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Several Polygons</title>

<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>

<style>
html, body, #map {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
}
</style>
</head>

<body>
<div id="map"></div>

<script>
ymaps.ready(function () {

  const map = new ymaps.Map("map", {
    center: [55.75, 37.61],
    zoom: 9
  });

  const params = new URLSearchParams(window.location.search);
  const polygonsRaw = params.get("polygons");

  if (!polygonsRaw) {
    console.warn("No polygons provided");
    return;
  }

  let polygons;
  try {
    // ВАЖНО: без decodeURIComponent
    polygons = JSON.parse(polygonsRaw);
  } catch (e) {
    console.error("Polygons parse error", e);
    return;
  }

  if (!Array.isArray(polygons)) {
    console.error("Polygons is not an array");
    return;
  }

  const geoObjects = [];

  polygons.forEach((coords, index) => {
    if (!Array.isArray(coords)) return;

    const polygon = new ymaps.Polygon(
      coords, // ✅ КРИТИЧНО: НЕ [coords]
      {},
      {
        fillColor: "#474A5155",
        strokeColor: "#474A51",
        strokeWidth: 2
      }
    );

    map.geoObjects.add(polygon);
    geoObjects.push(polygon);
  });

  if (geoObjects.length > 0) {
    map.setBounds(
      ymaps.geoQuery(geoObjects).getBounds(),
      { checkZoomRange: true }
    );
  } else {
    console.warn("No valid polygons to render");
  }

});
</script>

</body>
</html>
